<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Play Game | Ez10</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<style>
/* ==== Background ==== */
body {
  font-family: 'Poppins', sans-serif;
  background: url('https://images.unsplash.com/photo-1519389950473-47ba0277781c?auto=format&fit=crop&w=1600&q=80') no-repeat center center fixed;
  background-size: cover;
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  margin: 0;
  overflow: hidden;
}

body::before {
  content: '';
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 50, 0.3);
  backdrop-filter: blur(12px);
  z-index: 0;
}

/* ==== Container ==== */
.container {
  position: relative;
  z-index: 2;
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.25);
  border-radius: 25px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.4);
  padding: 40px;
  max-width: 700px;
  width: 90%;
  text-align: center;
  backdrop-filter: blur(20px);
}

h1 {
  color: #fff;
  font-size: 34px;
  margin-bottom: 10px;
  text-shadow: 0 0 12px rgba(255,255,255,0.6);
}

input {
  padding: 12px;
  border-radius: 15px;
  border: 1px solid rgba(255,255,255,0.4);
  background: rgba(255,255,255,0.15);
  width: 100%;
  margin: 10px 0;
  font-size: 16px;
  color: white;
  outline: none;
  backdrop-filter: blur(8px);
}
input::placeholder { color: rgba(255,255,255,0.7); }

button {
  background: rgba(0,123,255,0.7);
  color: white;
  border: none;
  border-radius: 25px;
  padding: 12px 28px;
  cursor: pointer;
  font-weight: 600;
  font-size: 16px;
  transition: all 0.3s ease;
  box-shadow: 0 0 8px rgba(0,123,255,0.5);
}
button:hover {
  background: rgba(0,123,255,1);
  box-shadow: 0 0 15px rgba(0,123,255,0.8);
  transform: scale(1.05);
}

/* ==== Question Card ==== */
.question-card {
  background: rgba(255,255,255,0.08);
  border-radius: 20px;
  padding: 20px;
  margin-top: 20px;
  text-align: left;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  color: white;
}

.choice {
  background: rgba(255,255,255,0.15);
  border: 1px solid rgba(255,255,255,0.3);
  border-radius: 15px;
  padding: 12px;
  margin: 10px 0;
  cursor: pointer;
  transition: 0.3s;
  font-weight: 500;
  color: #fff;
  text-shadow: 0 0 5px rgba(255,255,255,0.3);
}
.choice:hover {
  background: rgba(0,123,255,0.4);
  transform: scale(1.02);
}

.correct {
  background: rgba(0,255,150,0.5) !important;
  box-shadow: 0 0 12px rgba(0,255,150,0.6);
}
.incorrect {
  background: rgba(255,80,80,0.5) !important;
  box-shadow: 0 0 12px rgba(255,80,80,0.6);
}

/* ==== Score ==== */
.score-box {
  font-size: 22px;
  font-weight: 700;
  color: #66b3ff;
  margin-top: 20px;
  text-shadow: 0 0 10px rgba(255,255,255,0.4);
}

/* ==== Animation ==== */
.fade-in {
  animation: fadeIn 0.6s ease forwards;
}
@keyframes fadeIn {
  from {opacity: 0; transform: scale(0.95);}
  to {opacity: 1; transform: scale(1);}
}
</style>
</head>
<body>

<div class="container fade-in" id="gameContainer">
  <h1><i class="fa-solid fa-gamepad"></i> Ez10 Game</h1>

  <div id="joinScreen">
    <input id="kitCode" placeholder="Enter Kit Code">
    <input id="playerName" placeholder="Enter Your Name">
    <button onclick="startGame()">Start</button>
  </div>

  <div id="questionScreen" style="display:none;">
    <h2 id="questionText"></h2>
    <div id="choices"></div>
  </div>

  <div id="resultScreen" style="display:none;">
    <h2>ðŸŽ‰ Great job, <span id="playerDisplay"></span>!</h2>
    <p class="score-box">Your total score: <span id="finalScore">0</span> pts</p>
    <button onclick="window.location.reload()">Play Again</button>
  </div>
</div>

<script>
let currentKit = null;
let currentQuestion = 0;
let score = 0;

function startGame() {
  const code = document.getElementById('kitCode').value.trim();
  const name = document.getElementById('playerName').value.trim();
  if(!code || !name){ alert('Please fill in all fields.'); return; }

  const all = JSON.parse(localStorage.getItem('userKits') || '{}');
  let kitFound = null;

  // find the kit that matches the entered code and is active
  for(let user in all){
    const found = (all[user] || []).find(k => k.code === code && k.active);
    if(found){ kitFound = found; break; }
  }

  if(!kitFound){ alert('Invalid or inactive kit code.'); return; }

  currentKit = kitFound;
  document.getElementById('joinScreen').style.display='none';
  document.getElementById('questionScreen').style.display='block';
  showQuestion();
}

function showQuestion() {
  const q = currentKit.questions[currentQuestion];
  if(!q) return endGame();

  document.getElementById('questionText').textContent = `Q${currentQuestion+1}: ${q.question}`;
  const choiceDiv = document.getElementById('choices');
  choiceDiv.innerHTML = '';

  q.choices.forEach((choice, i)=>{
    const div = document.createElement('div');
    div.className = 'choice fade-in';
    div.textContent = `${String.fromCharCode(65+i)}) ${choice}`;
    div.onclick = () => selectAnswer(String.fromCharCode(65+i), div);
    choiceDiv.appendChild(div);
  });
}

function selectAnswer(ans, div){
  const q = currentKit.questions[currentQuestion];
  if(ans === q.correct){
    score += 10;
    div.classList.add('correct');
  } else {
    div.classList.add('incorrect');
  }

  Array.from(document.getElementsByClassName('choice')).forEach(c => c.onclick=null);

  setTimeout(()=>{
    currentQuestion++;
    showQuestion();
  }, 900);
}

function endGame() {
  document.getElementById('questionScreen').style.display = 'none';
  document.getElementById('resultScreen').style.display = 'block';
  document.getElementById('finalScore').textContent = score;
  document.getElementById('playerDisplay').textContent = document.getElementById('playerName').value;

  const currentUser = localStorage.getItem('loggedInUser') || document.getElementById('playerName').value.trim();
  const allStats = JSON.parse(localStorage.getItem('studentStats') || '{}');

  const userStats = allStats[currentUser] || [];
  userStats.push({
    kitCode: currentKit.code,
    score: score,
    correct: score / 10,
    total: currentKit.questions.length,
    date: new Date().toISOString()
  });

  allStats[currentUser] = userStats;
  localStorage.setItem('studentStats', JSON.stringify(allStats));
}
</script>
</body>
</html>
